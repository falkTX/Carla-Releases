language: cpp

os: linux

dist: focal

cache:
  directories:
    - ${HOME}/PawPawBuilds/builds
    - ${HOME}/PawPawBuilds/debs
    - ${HOME}/PawPawBuilds/downloads
    - ${HOME}/PawPawBuilds/targets/macos
    - ${HOME}/PawPawBuilds/targets/macos-universal
    - ${HOME}/PawPawBuilds/targets/win32
    - ${HOME}/PawPawBuilds/targets/win64

env:
  global:
    - BOOTSTRAP_VERSION=2

jobs:
  # linux with win32 cross-compilation
  - name: "win32 cross-compiled"
    os: linux
    compiler: gcc
    env:
      - TARGET="win32"
    services:
      - xvfb

  # linux with win64 cross-compilation
  - name: "win64 cross-compiled"
    os: linux
    compiler: gcc
    env:
      - TARGET="win64"
    services:
      - xvfb

  # macOS native intel build
  - name: "macOS native intel"
    os: osx
    osx_image: xcode9.4
    env:
      - TARGET="macos"

  # macOS universal build
  - name: "macOS universal"
    os: osx
    osx_image: xcode12.3
    env:
      - TARGET="macos-universal"

before_install:
  - bash ${TRAVIS_BUILD_DIR}/.travis/before_install.sh

install:
  - bash ${TRAVIS_BUILD_DIR}/.travis/install.sh

script:
  - rm -rf ${HOME}/PawPawBuilds/builds/macos-universal
  - rm -rf ${HOME}/PawPawBuilds/targets/macos-universal
  - bash ${TRAVIS_BUILD_DIR}/build.sh ${TARGET}

deploy:
  provider: releases
  api_key:
    secure: "RXDXPvFeD1Dx6gpbAkNzXJysdIDZANVd/DqGI8U9a1Ul75HyUV3h8pBpoAP180UnSdQaAOzmACSQoIgbdeFptovUuXL3nbEqAXCQcbykcbXAQ1SzO0xmT4WrJ7Uk9Z7T6MadzwYPmna8cCBNL2cT24D4N9rlH/FV+DoY9hpkf9TuE0FLXCXPhLsT+OxIOCblwoaZODuAgYLNaohfEwxow1GXwjKgl71rFkJ1M7iEJGRKpKALIhHeM6iKxbUuUHZcebwH/ga2tbEooL2O9tbDa6OFdHZ9NgzqtGkjeHwDMRVgPqcFPkFiglmi0AWzP/DJgnu36C1D0O81XRKCbjCDia+FH7n/mnA0XImWAx2VTL+JPBN7nzZZL3UscbyosWF3Kc9/7XpIyuV4h19XGQqwonXEZKRhAa2GDCKQQ5zE8cB6WN1YQWVJR66hfWSA2hqHjf2uRY67VP9+tYdlL5ygK70LaQpKQbUBKYKagJcyIbHl/J0tOCiJc5D7pl1i/Hew6Btdk+LuVwLrpmjINJwY9PFn/mIG95R9FnhwGUfVcuCqJgUm0+vnTmGuu7Hr+4QvVPVgfUb61gbLd+651YYoG2ERR91e1QREWZ4lXWwV5sACEPpM6/zU6/leD10qGMZKiYSQegpj2RAcZncZzeIqpn3nyN0aNZ1Hg90JFdOWjrs="
  file_glob: true
  file:
    - Carla/*.dmg
    - Carla/*.zip
  skip_cleanup: true
  on:
    tags: true
